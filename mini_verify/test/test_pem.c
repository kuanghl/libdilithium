#include <stdint.h>
#include <stdio.h>
#include <string.h>
#include "sign.h"
#include "b64.h"

// test for openssl
int main(void)
{
    char* pk_b64 = "MIIFMjALBglghkgBZQMEAxEDggUhAEPgA1FYXgXc3U3YokGuAwjMkGZGw6WIDfQU\
4pjbEut8k+EDSwSX2ZD9fOQVrD0Y297iBuqPpplRu2kfekWLH6XzXLFiHEwzAwOZ\
JmW7FuyLouIFn0OJKIaesg1VmfFvSU1cDJ1FP7uE7r98jIbw+oda74vPkQKItVIT\
gIZZojuNjC1Lkt+pK9MKzUpjc4RBaRQYsIbwc4BFbzSMIfyu3KvONUmwI41mwaJ4\
zmqG1BB/OheRpavKEGG4z9FTSm7foqNvecAHCqelyGRbTJxVmP71wyK2JDOICGmg\
2jVS/vG0ULdjurNo/pmv9Dn4CAFyCT2/zNcl9z1RE9JtcPn4nO4RtsGiutf19yS2\
ncOcOHgOaJWp/Gc4fEv5237X7cvVPdeT8zI1tEwkMTI8bZw+mrTT/uGt5TWVpcVc\
e9dSsuUdqtezMExjV4b80aXBNqMvD2eY/2wVKP8GV2N8KUJq1F1YtTI3+edRLk06\
dIMYCnX4rCAfhdLIN/KYWlOxVq+PWlV7ndVvJzBbcXnP9wrVxbL0eopmQqoVwv/c\
OLJtiyZC0QVnUxs/hYjy8Z1JdjSL4ZlHnlTO4GuHnOr3NzufVnwl5LYOvvIyBCMl\
FJa6RYpPXWlOe3Wy1JlAlTT6a27kQstgFJ3IcGH4uJ/cWJ8OxxVI8a2Icg5ddXw0\
Pg1+FYM8X169BkioSH8v6waa9K+pYtG9Mg2vYwWRyhFI1oKoFH2NFY9nkDZg8+s0\
V+l1fqNrneF3XLEem5wBJYEkGGqGMXtiOXAijRA4JL1uJrtxt9I2EEWhumaMD1ki\
Rr/yW1xkSn4xZUrdj8mR7R3a7Zc5GSiKAq+ZjSJJ3bzzVKs8cI/rqx579tjUW3Sz\
4Xik1hXWfaqRbsYlyUfPUGB0pRLGncqhalQZ8SdvTHmjMS9V5H1aQu/blTEwINV+\
0s41yZ+S/UTbT2jfTWG+OTJ0MOO524lZOPsd7ANqcefULfDhnQWSr3K/wVvfOFCm\
n5iOrP94WLKu5l3IDAh8gwDXYqCx16ZF/VXzSUAxAi68Mik20dbjrh4k9nrZklkA\
e7NMpJIAjcQfG6h4tFiBUxXQ+j6wxEPnfnm9d1aKohU3qhrccHz55zQFMJcSHbbE\
/KuCo7SZe/zfxsyZPHfpKwbm4X7URB00Zu42FhR/eHuMeQmmg0OhXWpCJSCjtx13\
+aQUD67o+BGViCYtsXzc/U2vmJkgssBIFxfcADOQiHTDIF0zHYXqajfJk28CWltt\
+EY0hY9yBrbDTt+WJx1wz+EO14lHvdYcSekqPE1Z0pFc7tL5a3sb0eDUILqjuO+e\
2BhTyL2Or5pTox2/5FWl/pctwz+i4/AwFyGufLBRDOBvvSgjaNImYq44xSf4pD/s\
Lq0zZ3HpeH/XC3tFSAniWO18WFuSNobJ9JW1MHJdi4ibCVlgMk4GnQJfrbnhxw3+\
U38e71AFQdyuxkajmxBY3hktyPu1dwsmMUiFtlJ3uZbXX69p4mnHJnsyX24jsc5T\
/GOvtcLmmXAOTkMUboKbSyL2/pLK2AaP1ClYGGru/ULVFQsrJv0u0Piveoqsr9++\
QIi2eyayGuArLq05+2s86B7Z3iLzyqqYGeJnyhN7eW8C6wFZAFhP0YanVBW9SbWQ\
vBlD7oVnzzc7ZjnSr+mp4Qj3ZLuHcMNbPK6XJZAI4w+VWvSYD6eHYHXhcZYu+J4E\
O7Lb8CcNng6IBvOHD37T4wK7QYJPOUPYqq8k5nsHZJ0Cy+Cs8NI=";
    char* sk_b64 = "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";
    char *msg_sig_b64 = "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";
    uint8_t msg[32] = "hello world!\n";
    uint8_t msg_len = strlen((char*)msg);
    // 22 and 66 for openssl ASN1.
    uint8_t pk[CRYPTO_PUBLICKEYBYTES + 22];
    uint8_t sk[CRYPTO_SECRETKEYBYTES + 66];
    uint8_t sig[CRYPTO_BYTES];
    // size_t siglen;
    int ret = 0;

    printf("msg %s", msg);
    printf("msg len %d\n\n", msg_len);
    printf("base64 decode need malloc len: pk %d sk %d, msg sig %d\n", 
        BASE64_DECODE_OUT_SIZE(strlen(pk_b64)),
        BASE64_DECODE_OUT_SIZE(strlen(sk_b64)),
        BASE64_DECODE_OUT_SIZE(strlen(msg_sig_b64)));

    ret = b64Decode(pk_b64, strlen(pk_b64), (char*)pk);
    printf("pk_b64 decoded len %d\n", ret);
    ret = b64Decode(sk_b64, strlen(sk_b64), (char*)sk);
    printf("sk_b64 decoded len %d\n", ret);
    ret = b64Decode(msg_sig_b64, strlen(msg_sig_b64), (char*)sig);
    printf("msg_sig_b64 decoded len %d\n\n", ret);

    ret = crypto_sign_verify(sig, CRYPTO_BYTES, msg, msg_len, NULL, 0, ((uint8_t*)pk + 22));
    printf("Verify %d\n", ret);

    return 0;
}